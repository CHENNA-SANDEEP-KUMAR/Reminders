<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Financial Reminders</title>
    <link rel="stylesheet" 
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script>
        function setAlarm(time, name) {
            if (time) {
                const now = new Date();
                const [hours, minutes] = time.split(":").map(Number);
                const alarm = new Date();
                alarm.setHours(hours, minutes, 0, 0);

                if (alarm > now) {
                    const timeout = alarm - now;
                    setTimeout(() => alert("Reminder: " + name), timeout);
                }
            }
        }
    </script>
</head>
<body class="container mt-4">
    <h1 class="mb-4">Financial Transaction Reminders</h1>

    <form action="/add" method="post" class="row g-3 mb-4">
        <div class="col-md-3">
            <input type="text" name="name" class="form-control" placeholder="Name" required>
        </div>
        <div class="col-md-2">
            <input type="number" name="amount" step="0.01" class="form-control" placeholder="Amount" required>
        </div>
        <div class="col-md-2">
            <input type="text" name="date" class="form-control" placeholder="DDMMYYYY" required>
        </div>
        <div class="col-md-2 form-check mt-2">
            <input type="checkbox" name="monthly" class="form-check-input">
            <label class="form-check-label">Monthly Reminder</label>
        </div>
        <div class="col-md-2">
            <input type="time" name="alarmTime" class="form-control">
        </div>
        <div class="col-md-1">
            <button class="btn btn-primary">Add</button>
        </div>
    </form>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th>Name</th>
            <th>Amount</th>
            <th>Date</th>
            <th>Monthly</th>
            <th>Alarm</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="reminder : ${reminders}" 
            th:attr="onload=|setAlarm('${reminder.alarmTime}', '${reminder.name}')|">
            <td th:text="${reminder.name}"></td>
            <td th:text="${reminder.amount}"></td>
            <td th:text="${reminder.date}"></td>
            <td th:text="${reminder.monthly} ? 'Yes' : 'No'"></td>
            <td th:text="${reminder.alarmTime}"></td>
        </tr>
        </tbody>
    </table>
</body>
</html>
